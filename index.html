<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 预览与目录</title>
    
    <!-- 引入 GitHub 风格的 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    <!-- 引入代码高亮 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    
    <style>
        body {
            margin: 0;
            display: flex;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        /* 左侧目录样式 */
        #sidebar {
            width: 280px;
            border-right: 1px solid #e1e4e8;
            padding: 20px;
            overflow-y: auto;
            background-color: #f6f8fa;
        }

        #sidebar h2 {
            font-size: 1.2rem;
            margin-top: 0;
        }

        #toc {
            list-style: none;
            padding: 0;
        }

        #toc li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        #toc a {
            text-decoration: none;
            color: #0366d6;
            font-size: 14px;
        }

        #toc a:hover {
            text-decoration: underline;
        }

        /* 缩进层级 */
        .toc-h1 { margin-left: 0; font-weight: bold; }
        .toc-h2 { margin-left: 15px; }
        .toc-h3 { margin-left: 30px; font-size: 0.9em; }

        /* 右侧内容样式 */
        #content-container {
            flex: 1;
            overflow-y: auto;
            padding: 45px;
            scroll-behavior: smooth;
        }

        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
        }

        @media (max-width: 767px) {
            body { flex-direction: column; }
            #sidebar { width: 100%; height: 200px; border-right: none; border-bottom: 1px solid #e1e4e8; }
            .markdown-body { padding: 15px; }
        }
    </style>
</head>
<body>

    <!-- 左侧目录 -->
    <aside id="sidebar">
        <h2>目录结构</h2>
        <ul id="toc">
            <!-- 目录将通过 JS 动态生成 -->
        </ul>
    </aside>

    <!-- 右侧内容 -->
    <main id="content-container">
        <article id="main-content" class="markdown-body">
            请从左侧选择一个文件查看内容...
        </article>
    </main>

    <!-- 依赖库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        // 1. 配置文件列表地址
        const fileListUrl = './files.json'; // JSON 文件路径
        const contentEl = document.getElementById('main-content');
        const tocUl = document.getElementById('toc');

        async function init() {
            try {
                // 2. 加载文件列表
                const response = await fetch(fileListUrl);
                if (!response.ok) throw new Error('无法加载文件列表');
                const files = await response.json();

                // 3. 生成文件导航菜单
                files.forEach(file => {
                    const li = document.createElement('li');
                    const a = document.createElement('a');
                    a.textContent = file.name;
                    a.style.cursor = 'pointer'; // 添加手型光标
                    a.onclick = () => loadMarkdown(file.url); // 点击加载 Markdown
                    li.appendChild(a);
                    tocUl.appendChild(li);
                });

                // 删除默认加载第一个文件的代码
                // 现在需要用户手动选择文件才会显示内容
            } catch (err) {
                tocUl.innerHTML = `<li style="color:red;">错误: ${err.message}</li>`;
            }
        }

        async function loadMarkdown(url) {
            try {
                // 4. 获取 Markdown 内容
                const response = await fetch(url);
                if (!response.ok) throw new Error('无法读取文件');
                const mdText = await response.text();

                // 5. 配置 marked 并渲染
                marked.setOptions({
                    highlight: function(code, lang) {
                        const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                        return hljs.highlight(code, { language }).value;
                    },
                    gfm: true,
                    breaks: true
                });

                contentEl.innerHTML = marked.parse(mdText);

                // 6. 生成目录（基于当前 Markdown 内容）
                generateTOC(contentEl);
            } catch (err) {
                contentEl.innerHTML = `<div style="color:red;">错误: ${err.message}</div>`;
            }
        }

        function generateTOC(contentEl) {
            const tocUl = document.getElementById('toc');
            tocUl.innerHTML = ''; // 清空之前的目录

            // 查找所有标题
            const headings = contentEl.querySelectorAll('h1, h2, h3');
            
            headings.forEach((heading, index) => {
                // 为标题添加 ID 方便跳转
                const id = 'heading-' + index;
                heading.setAttribute('id', id);

                // 创建目录项
                const li = document.createElement('li');
                li.classList.add('toc-' + heading.tagName.toLowerCase());
                
                const a = document.createElement('a');
                a.href = '#' + id;
                a.textContent = heading.textContent;
                
                li.appendChild(a);
                tocUl.appendChild(li);
            });

            if (headings.length === 0) {
                tocUl.innerHTML = '<li>无标题</li>';
            }
        }

        init();
    </script>
</body>
</html>
