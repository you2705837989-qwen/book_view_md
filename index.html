<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 预览与目录</title>
    
    <!-- 引入 GitHub 风格的 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    <!-- 引入代码高亮 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    
    <style>
        body {
            margin: 0;
            display: flex;
            height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
        }

        /* 左侧目录样式 */
        #sidebar {
            width: 280px;
            border-right: 1px solid #e1e4e8;
            padding: 20px;
            overflow-y: auto;
            background-color: #f6f8fa;
        }

        #sidebar h2 {
            font-size: 1.2rem;
            margin-top: 0;
        }

        #toc {
            list-style: none;
            padding: 0;
        }

        #toc li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        #toc a {
            text-decoration: none;
            color: #0366d6;
            font-size: 14px;
        }

        #toc a:hover {
            text-decoration: underline;
        }

        /* 缩进层级 */
        .toc-h1 { margin-left: 0; font-weight: bold; }
        .toc-h2 { margin-left: 15px; }
        .toc-h3 { margin-left: 30px; font-size: 0.9em; }

        /* 右侧内容样式 */
        #content-container {
            flex: 1;
            overflow-y: auto;
            padding: 45px;
            scroll-behavior: smooth;
        }

        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
        }

        @media (max-width: 767px) {
            body { flex-direction: column; }
            #sidebar { width: 100%; height: 200px; border-right: none; border-bottom: 1px solid #e1e4e8; }
            .markdown-body { padding: 15px; }
        }
    </style>
</head>
<body>

    <!-- 左侧目录 -->
    <aside id="sidebar">
        <h2>目录结构</h2>
        <ul id="toc">
            <!-- 目录将通过 JS 动态生成 -->
        </ul>
    </aside>

    <!-- 右侧内容 -->
    <main id="content-container">
        <article id="main-content" class="markdown-body">
            正在加载内容...
        </article>
    </main>

    <!-- 依赖库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <script>
        // 1. 配置本地 Markdown 文件地址
        const markdownFileUrl = './data/书完整转录_norm/马工程马克思主义基本原理2023年版.md'; // 这里替换成你的本地文件名

        async function init() {
            try {
                // 2. 获取 Markdown 内容
                const response = await fetch(markdownFileUrl);
                if (!response.ok) throw new Error('无法读取文件，请确保使用了本地服务器环境');
                const mdText = await response.text();

                // 3. 配置 marked (结合 highlight.js)
                marked.setOptions({
                    highlight: function(code, lang) {
                        const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                        return hljs.highlight(code, { language }).value;
                    },
                    gfm: true,
                    breaks: true
                });

                // 4. 渲染 Markdown
                const contentEl = document.getElementById('main-content');
                contentEl.innerHTML = marked.parse(mdText);

                // 5. 生成目录
                generateTOC(contentEl);

            } catch (err) {
                document.getElementById('main-content').innerHTML = 
                    `<div style="color:red;">错误: ${err.message}<br><small>提示：由于浏览器安全限制，请使用 Live Server 插件或任何 Web 服务器打开此 HTML。</small></div>`;
            }
        }

        function generateTOC(contentEl) {
            const tocUl = document.getElementById('toc');
            // 查找所有标题
            const headings = contentEl.querySelectorAll('h1, h2, h3');
            
            headings.forEach((heading, index) => {
                // 为标题添加 ID 方便跳转（如果原文件没有 ID）
                const id = 'heading-' + index;
                heading.setAttribute('id', id);

                // 创建目录项
                const li = document.createElement('li');
                li.classList.add('toc-' + heading.tagName.toLowerCase());
                
                const a = document.createElement('a');
                a.href = '#' + id;
                a.textContent = heading.textContent;
                
                li.appendChild(a);
                tocUl.appendChild(li);
            });

            if (headings.length === 0) {
                tocUl.innerHTML = '<li>无标题</li>';
            }
        }

        init();
    </script>
</body>
</html>
